<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!--
  ~ Copyright (C) 2025 Bitsea GmbH
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     https:www.apache.orglicensesLICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
  ~ SPDX-License-Identifier: Apache-2.0
  ~ License-Filename: LICENSE
  -->

<fragment xmlns="http://jmix.io/schema/flowui/fragment">
    <data>
        <instance id="inventoryItemDc" class="eu.occtet.bocfrontend.entity.InventoryItem">
            <fetchPlan extends="_base">
            </fetchPlan>
            <loader id="inventoryItemDl"/>
        </instance>
        <instance id="softwareComponentDc" class="eu.occtet.bocfrontend.entity.SoftwareComponent">
            <fetchPlan extends="_base">
                <property name="vulnerabilities" fetchPlan="_base"/>
            </fetchPlan>
        </instance>
        <collection id="codeLocationDc" class="eu.occtet.bocfrontend.entity.CodeLocation">
            <fetchPlan extends="_base"/>
            <loader id="codeLocationDl">
                <query>
                <![CDATA[
                    select c from CodeLocation c where c.inventoryItem=:inventoryItem
                ]]>
                </query>
            </loader>
        </collection>
        <collection id="licenseDc"
                    class="eu.occtet.bocfrontend.entity.License">
            <fetchPlan extends="_base"/>
        </collection>
        <collection id="copyrightDc"
                    class="eu.occtet.bocfrontend.entity.Copyright">
            <fetchPlan extends="_base"/>
            <loader id="copyrightDl">
                <query>
                    <![CDATA[select e from Copyright e]]>
                </query>
            </loader>
        </collection>
        <collection id="copyrightDcReuse"
                    class="eu.occtet.bocfrontend.entity.Copyright">
            <fetchPlan extends="_base"/>
            <loader id="copyrightDlReuse">
                <query>
                    <![CDATA[select e from Copyright e ]]>
                </query>
            </loader>
        </collection>
        <collection id="inventoryItemDcReuse"
                    class="eu.occtet.bocfrontend.entity.InventoryItem">
            <fetchPlan extends="_local">
                <property name="parent" fetchPlan="_base"/>
            </fetchPlan>
            <loader id="inventoryItemDlReuse" readOnly="true">
                <query>
                    <![CDATA[select i from InventoryItem i]]>
                </query>
            </loader>
        </collection>
    </data>
    <actions>
        <action id="saveAction"/>
    </actions>
    <content>
        <tabSheet id="mainTabSheet" width="100%" height="100%">
            <tab id="inventoriesTab" label="Inventory item">
                <formLayout id="form" dataContainer="inventoryItemDc">
                    <textField id="inventoryNameField" property="inventoryName"
                               label="Inventory Name" width="100%"/>
                    <hbox spacing="true" width="100%" alignItems="BASELINE">
                        <textField id="parentID" property="parent.inventoryName"
                                   label="Parent-Inventory item" width="100%"/>
                        <button id="parentButton" icon="INFO_CIRCLE_O" title="Show parent details"/>
                    </hbox>
                    <hbox spacing="true" width="100%" alignItems="BASELINE">
                        <textField id="softwareComponentField" label="Software component"
                                   property="softwareComponent" width="100%"/>
                        <button id="softwareComponentButton" title="Show component details" icon="INFO_CIRCLE_O"/>
                    </hbox>
                    <textField id="detailsUrlTextField" property="detailsUrl" label="url"
                               dataContainer="softwareComponentDc"/>
                    <hbox spacing="true" width="100%" alignItems="BASELINE">
                        <textField id="priorityField" label="Priority" property="priority" width="70px"/>
                    </hbox>
                    <hbox spacing="true">
                        <checkbox id="curatedID" property="curated" label="Curated"/>
                        <checkbox id="combinedID" property="wasCombined" label="Combined"/>
                    </hbox>
                    <htmlObject colspan="2">
                        <hr></hr>
                    </htmlObject>
                    <hbox spacing="true" width="100%" colspan="2">
                        <vbox spacing="true" alignItems="CENTER" width="50%">
                            <dataGrid id="licensesDataGrid"
                                      width="100%"
                                      height="20em"
                                      dataContainer="licenseDc">
                                <columns>
                                    <column property="licenseType" header="License"/>
                                </columns>
                            </dataGrid>
                            <hbox>
                                <dropdownButton id="editLicense" text="edit" icon="lumo:edit"
                                                dropdownIndicatorVisible="false" themeNames="small">
                                    <items>
                                        <componentItem id="createLicense">
                                            <hbox padding="false">
                                                <span text="create new"/>
                                            </hbox>
                                        </componentItem>
                                        <componentItem id="addLicense">
                                            <hbox padding="false">
                                                <span text="add"/>
                                            </hbox>
                                        </componentItem>
                                        <componentItem id="removeLicense">
                                            <hbox padding="false">
                                                <span text="remove"/>
                                            </hbox>
                                        </componentItem>
                                    </items>
                                </dropdownButton>
                                <button id="removeLicenseButton" icon="TRASH" visible="false" themeNames="error small"/>
                            </hbox>
                        </vbox>
                        <vbox spacing="true" alignItems="CENTER" width="50%">
                            <dataGrid id="copyrightsDataGrid"
                                      width="100%"
                                      height="20em"
                                      dataContainer="copyrightDc">
                                <columns>
                                    <column property="copyrightText" header="Copyright"/>
                                </columns>
                            </dataGrid>
                            <hbox>
                                <dropdownButton id="editCopyright" text="edit" icon="lumo:edit"
                                                dropdownIndicatorVisible="false" themeNames="small">
                                    <items>
                                        <componentItem id="createCopyright">
                                            <hbox padding="false">
                                                <span text="create new"/>
                                            </hbox>
                                        </componentItem>
                                        <componentItem id="addCopyright">
                                            <hbox padding="false">
                                                <span text="add"/>
                                            </hbox>
                                        </componentItem>
                                        <componentItem id="removeCopyright">
                                            <hbox padding="false">
                                                <span text="remove"/>
                                            </hbox>
                                        </componentItem>
                                    </items>
                                </dropdownButton>
                                <button id="removeCopyrightButton" icon="TRASH" visible="false"
                                        themeNames="error small"/>
                            </hbox>
                        </vbox>
                    </hbox>
                    <hbox>
                        <nativeLabel text="Created at: "/>
                        <nativeLabel id="createdField" property="createdAt"  colspan="2"/>
                    </hbox>
                </formLayout>
            </tab>
            <tab id="vulnerabilitiesTab" label="Vulnerabilities">
                <vbox>
                    <fragment class="eu.occtet.bocfrontend.view.audit.fragment.Vulnerabilitytabfragment" id="vulnerabilitytabfragment"/>
                </vbox>
            </tab>
            <tab id="filesTab" label="Files">
                <fragment class="eu.occtet.bocfrontend.view.audit.fragment.FilesTabFragment"
                          id="filesTabFragment"/>
            </tab>
            <tab id="auditNotesTab" label="Audit notes">
                <richTextEditor id="auditNotesText" label="Notes" width="100%"
                          height="100%" property="externalNotes" dataContainer="inventoryItemDc" themeNames="compact"/>
            </tab>
            <tab id="reuseTab" label="msg://eu.occtet.bocfrontend.view.audit/auditView.reuse">
                <vbox width="100%" height="100%">
                    <split width="100%" themeNames="small" orientation="VERTICAL">
                        <hbox width="100%" height="70%" classNames="border rounded-m border-contrast-20">
                            <tabSheet id="ReuseTabSheet" width="100%" height="100%" >
                                <tab id="generalInformationReuse" label="General information">
                                    <vbox>
                                            <vbox>
                                                <hbox>
                                                    <textField id="inventoryNameReuseField" property="inventoryName"
                                                               label="Inventory Name" width="25em"/>
                                                    <textField id="softwareComponentReuseField" label="Software component"
                                                               width="25em"/>
                                                    <textField id="priorityReuseField" label="Priority" maxWidth="10em"/>
                                                    <textField id="createdAtIDReuse" property="createdAt" label="Created"/>
                                                </hbox>
                                                <hbox>
                                                    <textField id="linkingIDReuse" property="linking" label="Linking"/>
                                                    <textField id="sizeIDReuse" property="size" label="Size" maxWidth="5em"/>
                                                </hbox>
                                                <hbox>
                                                    <textField id="parentReuseID" property="parent.inventoryName"
                                                               label="Parent-Inventory item" width="25em"/>
                                                    <button id="parentReuseButton" title="Show parent details"
                                                            width="5em" alignSelf="END" icon="INFO_CIRCLE_O"/>
                                                </hbox>
                                                <hbox>
                                                    <checkbox id="curatedIDReuse" property="curated" label="Curated"/>
                                                    <checkbox id="combinedIDReuse" property="wasCombined" label="Combined"/>
                                                </hbox>
                                            </vbox>

                                        <vbox width="50%" alignSelf="START" alignItems="CENTER">
                                            <dataGrid id="copyrightsDataGridReuse"
                                                      minWidth="35em"
                                                      height="15em"
                                                      dataContainer="copyrightDcReuse"
                                                      columnReorderingAllowed="true">
                                                <columns resizable="true">
                                                    <column property="copyrightText" header="Copyright"/>
                                                </columns>
                                            </dataGrid>
                                            <button id="copyrightReuseButton"
                                                    text="Move copyrights to latest inventory"
                                                    alignSelf="START" themeNames="small"/>
                                        </vbox>
                                    </vbox>
                                </tab>
                                <tab id="ReuseFilesTab" label="Files">
                                    <fragment class="eu.occtet.bocfrontend.view.audit.fragment.FilesTabFragment"
                                              id="filesReuseTabFragment"/>
                                </tab>
                                <tab id="ReuseAuditNotes" label="Audit notes">
                                        <vbox width="100%" height="100%" alignItems="CENTER" alignSelf="CENTER">
                                            <textArea id="auditNotesTextReuse" label="Audit notes"
                                                      property="externalNotes" width="100%" height="100%"
                                                      alignSelf="CENTER" />
                                            <button id="auditReuseButton" text="Add notes to latest inventory"
                                                    alignSelf="CENTER" themeNames="small"/>
                                        </vbox>
                                </tab>
                            </tabSheet>
                        </hbox>
                        <hbox width="100%" height="30%" alignItems="CENTER" classNames="border rounded-m border-contrast-20" >
                           <vbox width="100%" height="100%" >
                               <nativeLabel text="msg://eu.occtet.bocfrontend.view.audit.fragment.InventoryItemTabFragment/reuseItems"/>
                            <dataGrid id="inventoryDataGridReuse"
                                      width="100%"
                                      height="100%"
                                      dataContainer="inventoryItemDcReuse"
                                      columnReorderingAllowed="true">
                                <columns resizable="true">
                                    <column property="inventoryName" header="Reuse-items"/>
                                    <column property="createdAt" header="Date"/>
                                </columns>
                            </dataGrid>
                           </vbox>
                        </hbox>
                    </split>
                </vbox>
            </tab>
            <suffix>
                <hbox>
                    <button id="saveButton" text="save" themeNames="primary small" action="saveAction"/>
                </hbox>
            </suffix>
        </tabSheet>
    </content>
</fragment>