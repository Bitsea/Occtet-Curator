<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!--
  ~ Copyright (C) 2025 Bitsea GmbH
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     https:www.apache.orglicensesLICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
  ~ SPDX-License-Identifier: Apache-2.0
  ~ License-Filename: LICENSE
  -->

<fragment xmlns="http://jmix.io/schema/flowui/fragment">
    <data>
        <instance id="inventoryItemDc" class="eu.occtet.bocfrontend.entity.InventoryItem">
            <fetchPlan extends="_base">
                <property name="softwareComponent" fetchPlan="_base"/>
                <property name="parent" fetchPlan="_base">
                    <property name="inventoryName"/>
                </property>

            </fetchPlan>
            <loader id="inventoryItemDl"/>
        </instance>
        <instance id="softwareComponentDc" class="eu.occtet.bocfrontend.entity.SoftwareComponent">
            <fetchPlan extends="_base">
                <property name="vulnerabilities" fetchPlan="_base"/>
            </fetchPlan>
        </instance>
        <collection id="codeLocationDc" class="eu.occtet.bocfrontend.entity.CodeLocation">
            <fetchPlan extends="_base"/>
            <loader id="codeLocationDl">
                <query>
                <![CDATA[
                    select c from CodeLocation c where c.inventoryItem=:inventoryItem
                ]]>
                </query>
            </loader>
        </collection>
        <collection id="licenseDc"
                    class="eu.occtet.bocfrontend.entity.License">
            <fetchPlan extends="_base"/>
        </collection>
        <collection id="copyrightDc"
                    class="eu.occtet.bocfrontend.entity.Copyright">
            <fetchPlan extends="_base"/>
            <loader id="copyrightDl">
                <query>
                    <![CDATA[select e from Copyright e]]>
                </query>
            </loader>
        </collection>
        <collection id="inventoryItemDcReuse"
                    class="eu.occtet.bocfrontend.entity.InventoryItem">
            <fetchPlan extends="_local">
                <property name="parent" fetchPlan="_base"/>
            </fetchPlan>
            <loader id="inventoryItemDlReuse" readOnly="true">
                <query>
                    <![CDATA[select i from InventoryItem i]]>
                </query>
            </loader>
        </collection>
    </data>
    <actions>
        <action id="saveAction"/>
    </actions>
    <content>
        <tabSheet id="mainTabSheet" width="100%" height="100%">
            <tab id="inventoriesTab" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.inventory.header" >
                <vbox id="form"  height="100%">
                    <vbox id="inventoryNameField" margin="false" padding="false"/>
                    <hbox spacing="true" width="100%" alignItems="BASELINE">
                        <comboBox id="parentField" property="parent"
                                  label="msg://eu.occtet.bocfrontend.entity/InventoryItem.parent" width="50%" dataContainer="inventoryItemDc"/>
                        <button id="parentButton" icon="INFO_CIRCLE_O" title="Show parent details"/>
                    </hbox>
                    <hbox spacing="true" width="100%" alignItems="BASELINE">
                        <textField id="softwareComponentField" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.header"
                                   property="softwareComponent" dataContainer="inventoryItemDc" width="50%"/>
                        <button id="softwareComponentButton" title="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.button" icon="INFO_CIRCLE_O"/>
                    </hbox>
                    <textField id="detailsUrlTextField" property="detailsUrl" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.url"
                               dataContainer="softwareComponentDc" width="100%"/>
                    <hbox spacing="true" width="100%" alignItems="BASELINE">
                        <textField id="priorityField" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.priority" property="priority" dataContainer="inventoryItemDc"
                                   width="100px"/>
                    </hbox>
                    <hbox spacing="true">
                        <checkbox id="curatedID" property="curated"  dataContainer="inventoryItemDc" label="msg://eu.occtet.bocfrontend.entity/Copyright.curated"/>
                        <checkbox id="combinedID" property="wasCombined" dataContainer="inventoryItemDc" label="msg://eu.occtet.bocfrontend.entity/InventoryItem.wasCombined"/>
                        <checkbox id="licenseAIControlled" property="softwareComponent.licenseAiControlled" dataContainer="inventoryItemDc" label="msg://eu.occtet.bocfrontend.view.softwareComponent/licenseAiControlled"/>
                    </hbox>
                    <htmlObject colspan="2">
                        <hr></hr>
                    </htmlObject>
                    <hbox spacing="true" width="100%" colspan="2">
                        <vbox spacing="true" alignItems="CENTER" width="50%">
                            <dataGrid id="licensesDataGrid"
                                      width="100%"
                                      height="20em"
                                      dataContainer="licenseDc">
                                <columns>
                                    <column property="licenseType" header="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.license"/>
                                </columns>
                            </dataGrid>
                            <hbox>
                                <dropdownButton id="editLicense" text="edit" icon="lumo:edit"
                                                dropdownIndicatorVisible="false" themeNames="small">
                                    <items>
                                        <componentItem id="createLicense">
                                            <hbox padding="false">
                                                <span text="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.dropdown.create"/>
                                            </hbox>
                                        </componentItem>
                                        <componentItem id="addLicense">
                                            <hbox padding="false">
                                                <span text="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.dropdown.add"/>
                                            </hbox>
                                        </componentItem>
                                        <componentItem id="removeLicense">
                                            <hbox padding="false">
                                                <span text="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.dropdown.remove"/>
                                            </hbox>
                                        </componentItem>
                                    </items>
                                </dropdownButton>
                                <button id="removeLicenseButton" icon="TRASH" visible="false" themeNames="error small"/>
                            </hbox>
                        </vbox>
                        <vbox spacing="true" alignItems="CENTER" width="50%">
                            <dataGrid id="copyrightsDataGrid"
                                      width="100%"
                                      height="20em"
                                      dataContainer="copyrightDc">
                                <columns>
                                    <column property="copyrightText" header="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.copyright.heaer"/>
                                </columns>
                            </dataGrid>
                            <hbox>
                                <dropdownButton id="editCopyright" text="edit" icon="lumo:edit"
                                                dropdownIndicatorVisible="false" themeNames="small">
                                    <items>
                                        <componentItem id="createCopyright">
                                            <hbox padding="false">
                                                <span text="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.dropdown.create"/>
                                            </hbox>
                                        </componentItem>
                                        <componentItem id="addCopyright">
                                            <hbox padding="false">
                                                <span text="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.dropdown.add"/>
                                            </hbox>
                                        </componentItem>
                                        <componentItem id="removeCopyright">
                                            <hbox padding="false">
                                                <span text="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.dropdown.remove"/>
                                            </hbox>
                                        </componentItem>
                                    </items>
                                </dropdownButton>
                                <button id="removeCopyrightButton" icon="TRASH" visible="false"
                                        themeNames="error small"/>
                            </hbox>
                        </vbox>
                    </hbox>
                    <hbox>
                        <nativeLabel text="Created at: "/>
                        <nativeLabel id="createdField" property="createdAt" dataContainer="inventoryItemDc" colspan="2"/>
                    </hbox>
                </vbox>
            </tab>
            <tab id="vulnerabilitiesTab" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.vulnerability.label">
                <vbox height="100%">
                    <fragment class="eu.occtet.bocfrontend.view.audit.fragment.Vulnerabilitytabfragment" id="vulnerabilitytabfragment"/>
                </vbox>
            </tab>
            <tab id="filesTab" label="Files">
                <fragment class="eu.occtet.bocfrontend.view.audit.fragment.FilesTabFragment"
                          id="filesTabFragment"/>
            </tab>
            <tab id="auditNotesTab" label="Audit notes">
                    <vbox id="auditNotesText" width="100%" height="100%"/>

            </tab>
            <tab id="reuseTab" label="msg://eu.occtet.bocfrontend.view.audit/auditView.reuse">
                <vbox width="100%" height="100%">
                    <split width="100%" height="100%" themeNames="small" orientation="VERTICAL">
                        <hbox width="100%" height="70%" classNames="border rounded-m border-contrast-20">
                            <tabSheet id="ReuseTabSheet" width="100%" height="100%" >
                                <tab id="generalInformationReuse" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.vulnerability.generalInformation">
                                    <vbox>
                                            <vbox>
                                                <hbox>
                                                    <textField id="inventoryNameReuseField" property="inventoryName" dataContainer="inventoryItemDcReuse"
                                                               label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.inventoryName" width="25em"/>
                                                    <textField id="softwareComponentReuseField" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.header"
                                                               width="25em"/>
                                                    <textField id="priorityReuseField" label="eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.softwareComponent.priority" property="priority" dataContainer="inventoryItemDcReuse" maxWidth="10em"/>
                                                    <textField id="createdAtIDReuse" property="createdAt" dataContainer="inventoryItemDcReuse" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.created"/>
                                                </hbox>
                                                <hbox>
                                                    <textField id="linkingIDReuse" property="linking" dataContainer="inventoryItemDcReuse" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.linking"/>
                                                    <textField id="sizeIDReuse" property="size" dataContainer="inventoryItemDcReuse" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.size" maxWidth="5em"/>
                                                </hbox>
                                                <hbox>
                                                    <textField id="parentReuseID" property="parent.inventoryName" dataContainer="inventoryItemDcReuse"
                                                               label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.parent" width="25em"/>
                                                    <button id="parentReuseButton" title="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.parent.button"
                                                            width="5em" alignSelf="END" icon="INFO_CIRCLE_O"/>
                                                </hbox>
                                                <hbox>
                                                    <checkbox id="curatedIDReuse" property="curated" dataContainer="inventoryItemDcReuse" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.curated"/>
                                                    <checkbox id="combinedIDReuse" property="wasCombined" dataContainer="inventoryItemDcReuse" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.combined"/>
                                                </hbox>
                                            </vbox>
                                    </vbox>
                                </tab>
                                <tab id="ReuseFilesTab" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.files">
                                    <fragment class="eu.occtet.bocfrontend.view.audit.fragment.FilesTabFragment"
                                              id="filesReuseTabFragment"/>
                                </tab>
                                <tab id="ReuseAuditNotes" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.auditNotes">
                                        <vbox width="100%" height="100%" alignItems="CENTER" alignSelf="CENTER">
                                            <textArea id="auditNotesTextReuse" label="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.auditNotes"
                                                      property="externalNotes" dataContainer="inventoryItemDcReuse" width="100%" height="100%"
                                                      alignSelf="CENTER" />
                                            <button id="auditReuseButton" text="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.auditNotes.text"
                                                    alignSelf="CENTER" themeNames="small"/>
                                        </vbox>
                                </tab>
                            </tabSheet>
                        </hbox>
                        <hbox width="100%" height="30%" alignItems="CENTER" classNames="border rounded-m border-contrast-20" >
                           <vbox width="100%" height="100%" >
                               <nativeLabel text="msg://eu.occtet.bocfrontend.view.audit.fragment.InventoryItemTabFragment/reuseItems"/>
                            <dataGrid classNames="occtet-grid" id="inventoryDataGridReuse"
                                      width="100%"
                                      height="100%"
                                      dataContainer="inventoryItemDcReuse"
                                      columnReorderingAllowed="true"  >
                                <columns resizable="true">
                                    <column property="inventoryName" header="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.auditNotes.reuse"/>
                                    <column property="createdAt" header="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.auditNotes.date"/>
                                </columns>
                            </dataGrid>
                           </vbox>
                        </hbox>
                    </split>
                </vbox>
            </tab>
            <suffix>
                <hbox>
                    <button id="saveButton" text="msg://eu.occtet.bocfrontend.view/inventoryTabFragment.tabSheet.auditNotes.save" themeNames="primary small" action="saveAction"/>
                </hbox>
            </suffix>
        </tabSheet>
    </content>
</fragment>