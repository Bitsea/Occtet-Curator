<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!--
  ~ Copyright (C) 2025 Bitsea GmbH
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     https:www.apache.orglicensesLICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
  ~ SPDX-License-Identifier: Apache-2.0
  ~ License-Filename: LICENSE
  -->

<view xmlns="http://jmix.io/schema/flowui/view"
      title="msg://copyrightDetailView.title"
      focusComponent="form">
    <data>
        <instance id="copyrightDc"
                  class="eu.occtet.bocfrontend.entity.Copyright">
            <fetchPlan extends="_base">
                <property name="codeLocations" fetchPlan="_base"/>
                <property name="licenses" fetchPlan="_base"/>
            </fetchPlan>
            <loader id="copyrightDl">
                <query>
                    <![CDATA[
                    select distinct c
                    from Copyright c
                    left join c.codeLocations cl]]>
                </query>

            </loader>
            <collection id="licenseDataGrid" property="licenses"/>
            <collection id="codeLocationsDc" property="codeLocations"/>
        </instance>

        <collection id="licenseDc"
                    class="eu.occtet.bocfrontend.entity.License">
            <fetchPlan extends="_base"/>
        </collection>


    </data>
    <facets>
        <dataLoadCoordinator auto="true"/>
    </facets>
    <actions>
        <action id="saveAction" type="detail_saveClose"/>
        <action id="closeAction" type="detail_close"/>
    </actions>
    <layout width="100%">
        <vbox id="form" width="100%">
            <vbox >
                <textField id="copyrightTextField" property="copyrightText" dataContainer="copyrightDc" label="Name" minWidth="100%"/>
                <dataGrid id="codeLocationsGrid"
                          dataContainer="codeLocationsDc"
                          width="100%">
                    <columns>
                        <column property="filePath"/>
                    </columns>
                </dataGrid>
            </vbox>
            <hbox>
                <checkbox id="curatedField" dataContainer="copyrightDc" property="curated" label="Curated"/>
                <checkbox id="garbageField" dataContainer="copyrightDc" property="garbage" label="Garbage"/>
            </hbox>
                <dataGrid dataContainer="licenseDc"  id="licensesDataGrid" width="100%" >
                    <columns resizable="true">
                        <column header="msg://eu.occtet.bocfrontend.entity/License.licenseName" property="licenseName"> </column>
                        <column header="msg://eu.occtet.bocfrontend.entity/LicenseType.licenseId" property="licenseType"/>
                        <column header="msg://eu.occtet.bocfrontend.entity/LicenseType.detailsUrl" property="detailsUrl"/>
                        <column header="msg://licensetype.isSpdx" property="isSpdx"/>
                    </columns>
                </dataGrid>
                <hbox id="detailActions">
                    <button id="saveAndCloseButton" action="saveAction"/>
                    <button id="closeButton" action="closeAction"/>
                    <button id="addLicense" text="msg://addLicense"/>
                    <button id="removeLicenseButton" icon="TRASH" themeNames="error small"/>
                </hbox>

        </vbox>
    </layout>
</view>
