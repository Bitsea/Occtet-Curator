<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!--
  ~ Copyright (C) 2025 Bitsea GmbH
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     https:www.apache.orglicensesLICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
  ~ SPDX-License-Identifier: Apache-2.0
  ~ License-Filename: LICENSE
  -->

<view xmlns="http://jmix.io/schema/flowui/view"
      title="msg://softwareComponentDetailView.title"
      focusComponent="form">
    <data>
        <instance id="softwareComponentDc"
                  class="eu.occtet.bocfrontend.entity.SoftwareComponent">
            <collection id="vulnerabilityDc" property="vulnerabilities"/>
            <fetchPlan extends="_base">
            </fetchPlan>
            <loader id="softwareComponentDl"/>
        </instance>
        <collection id="licenseDc"
                    class="eu.occtet.bocfrontend.entity.License">
            <fetchPlan extends="_base"/>
            <loader id="licenseDl">
                <query>
                    <![CDATA[select e from License e]]>
                </query>
            </loader>
        </collection>
    </data>
    <facets>
        <dataLoadCoordinator auto="true"/>
    </facets>
    <actions>
        <action id="saveAction" type="detail_saveClose"/>
        <action id="closeAction" type="detail_close"/>
    </actions>
    <layout>
        <tabSheet width="100%" themeNames="bordered" height="100%">
            <tab id="generalInformationTab" label="General information">
                <vbox alignItems="CENTER" justifyContent="START" alignSelf="START" classNames="scanner-layout" height="100%">
                    <formLayout id="form" dataContainer="softwareComponentDc">
                        <textField id="nameField" property="name" label="Name"/>
                        <hbox>
                            <textField id="versionField" property="version" label="Version" width="10em"/>
                        </hbox>
                        <textField id="url" property="detailsUrl" label="URL"/>
                        <checkbox id="curatedField" property="curated" label="Curated"/>
                        <htmlObject id="spacer" colspan="2">
                            <hr></hr>
                        </htmlObject>
                        <vbox colspan="2" padding="false">
                            <hbox width="100%">
                                <vbox>
                                    <dataGrid id="vulnerabilityDataContainer" dataContainer="vulnerabilityDc" themeNames="">
                                        <columns resizable="true" sortable="true">
                                            <column property="vulnerabilityId" header="id"/>
                                            <column property="aliases" header="aliases" autoWidth="true"/>
                                            <column property="weightedSeverity" header="weighted severity"/>
                                            <column property="exploitability" header="exploitability"/>
                                            <column property="riskScore" header="risk score"/>
                                            <column property="sourceUrl" header="sourceUrl"/>
                                            <column property="createdAt" header="last updated"/>
                                            <column key="actions"
                                                    sortable="false"
                                                    autoWidth="true"
                                                    flexGrow="0"/>
                                        </columns>
                                    </dataGrid>
                                    <button id="updateData" title="update data" icon="REFRESH" text="Update data"/>
                                </vbox>
                            </hbox>
                        </vbox>
                    </formLayout>
                    <hbox id="detailActions" justifyContent="CENTER" alignItems="CENTER" alignSelf="CENTER" height="100%">
                        <button id="saveAndCloseButton" action="saveAction" alignSelf="END"/>
                        <button id="closeButton" action="closeAction" alignSelf="END"/>
                    </hbox>
                </vbox>
            </tab>
            <tab id="licensestab" label="Licenses">
                <vbox width="100%" alignItems="CENTER" alignSelf="END" height="100%">
                    <dataGrid id="licensesDataGrid"
                              width="100%"
                              height="40em"
                              dataContainer="licenseDc"
                              columnReorderingAllowed="true" alignSelf="CENTER">
                        <columns resizable="true">
                            <column property="licenseType" header="Type"/>
                            <column property="priority" header="Priority"/>
                            <column property="licenseText" header="License text"/>
                            <column property="licenseName" header="Licence name"/>
                            <column property="detailsUrl" header="Details url"/>
                            <column property="isModified" header="Modified"/>
                            <column property="curated" header="Curated"/>
                            <column property="isSpdx" header="SPDX"/>
                        </columns>
                    </dataGrid>
                    <button id="addLicenseButton" text="add license" alignSelf="CENTER"/>
                </vbox>
            </tab>
        </tabSheet>
    </layout>
</view>
