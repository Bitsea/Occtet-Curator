<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!--
  ~ Copyright (C) 2025 Bitsea GmbH
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     https:www.apache.orglicensesLICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
  ~ SPDX-License-Identifier: Apache-2.0
  ~ License-Filename: LICENSE
  -->

<view xmlns="http://jmix.io/schema/flowui/view"
      title="msg://softwareComponentDetailView.title"
      focusComponent="form">
    <data>
        <instance id="softwareComponentDc"
                  class="eu.occtet.bocfrontend.entity.SoftwareComponent">
            <fetchPlan extends="_base">
                <property name="vulnerabilities" fetchPlan="_base"/>
                <property name="copyrights" fetchPlan="_base"/>
            </fetchPlan>
            <collection id="copyrightDc" property="copyrights"/>
            <fetchPlan extends="_base">
                <property name="copyrights" fetchPlan="_base"/>
            </fetchPlan>
            <loader id="softwareComponentDl"/>
            </instance>
        <collection id="vulnerabilityDc" class="eu.occtet.bocfrontend.entity.Vulnerability">
            <fetchPlan extends="_base"/>
            <loader id="vulnerabilityDl">
                <query>
                    <![CDATA[select e from Vulnerability e]]>
                </query>

            </loader>
        </collection>
        <collection id="licenseDc"
                    class="eu.occtet.bocfrontend.entity.License">
            <fetchPlan extends="_base"/>
            <loader id="licenseDl">
                <query>
                    <![CDATA[select e from License e]]>
                </query>
            </loader>
        </collection>
    </data>
    <facets>
        <dataLoadCoordinator auto="true"/>
    </facets>
    <actions>
        <action id="saveAction" type="detail_saveClose"/>
        <action id="closeAction" type="detail_close"/>
    </actions>
    <layout>
        <tabSheet width="100%" themeNames="no-padding" height="100%">
            <tab id="generalInformationTab" label="msg://generalInformationTab.label">
                <vbox alignItems="CENTER" justifyContent="START" alignSelf="START" height="100%">
                    <formLayout id="form" dataContainer="softwareComponentDc">
                        <textField id="nameField" property="name" label="msg://eu.occtet.bocfrontend.entity/Configuration.name"/>
                        <hbox>
                            <textField id="versionField" property="version" label="msg://eu.occtet.bocfrontend.entity/Project.version" width="10em"/>
                        </hbox>
                        <textField id="url" property="detailsUrl" label="msg://eu.occtet.bocfrontend.entity/LicenseType.detailsUrl"/>
                        <checkbox id="curatedField" property="curated" label="msg://eu.occtet.bocfrontend.entity/Copyright.curated"/>
                        <checkbox id="licenseAICurated" property="licenseAiControlled" label="msg://licenseAiControlled"/>
                    </formLayout>
                    <hbox id="detailActions" justifyContent="CENTER" alignItems="CENTER" alignSelf="CENTER" height="100%">
                        <button id="saveAndCloseButton" action="saveAction" alignSelf="END"/>
                        <button id="closeButton" action="closeAction" alignSelf="END"/>
                    </hbox>
                </vbox>
            </tab>
            <tab id="vulnerabilitiesTab" label="msg://VulnerabilitiesTab.label">
                <vbox width="100%" alignItems="CENTER" alignSelf="END" height="100%">
                    <dataGrid id="vulnerabilityDataContainer" dataContainer="vulnerabilityDc" themeNames="">
                        <columns resizable="true" sortable="true">
                            <column property="vulnerabilityId" header="msg://Id"/>
                            <column property="aliases" header="msg://eu.occtet.bocfrontend.entity/Vulnerability.aliases" autoWidth="true"/>
                            <column property="weightedSeverity" header="msg://eu.occtet.bocfrontend.entity/Vulnerability.weightedSeverity"/>
                            <column property="exploitability" header="msg://eu.occtet.bocfrontend.entity/Vulnerability.exploitability"/>
                            <column property="riskScore" header="msg://eu.occtet.bocfrontend.entity/Vulnerability.riskScore"/>
                            <column property="sourceUrl" header="msg://softwareComponent.sourceUrl"/>
                            <column property="createdAt" header="msg://eu.occtet.bocfrontend.entity/ScannerInitializer.lastUpdate"/>
                            <column key="actions"
                                    sortable="false"
                                    autoWidth="true"
                                    flexGrow="0"/>
                        </columns>
                    </dataGrid>
                    <button id="updateData" text="msg://updateVulnerabilties" icon="REFRESH" />
                </vbox>
            </tab>
            <tab id="copyrightTab" label="msg://copyrightsTab.label">
            <vbox width="100%" alignItems="CENTER" alignSelf="END" height="100%">
                <dataGrid classNames="occtet-grid" id="copyrightDataContainer" dataContainer="copyrightDc" themeNames="">
                    <columns resizable="true" sortable="true">
                        <column property="copyrightText"/>
                        <column property="curated"/>
                        <column property="garbage"/>
                    </columns>
                    <actions>
                        <action id="createAction" type="list_create"/>
                        <action id="addAction" type="list_add"/>
                    </actions>
                </dataGrid>
                <hbox>
                    <button id="createButton" action="copyrightDataContainer.createAction"/>
                    <button id="addButton" action="copyrightDataContainer.addAction"/>
                </hbox>
            </vbox>
            </tab>
            <tab id="licensestab" label="Licenses">
                <vbox width="100%" alignItems="CENTER" alignSelf="END" height="100%">
                    <dataGrid classNames="occtet-grid" id="licensesDataGrid"
                              width="100%"
                              height="40em"
                              dataContainer="licenseDc"
                              columnReorderingAllowed="true" alignSelf="CENTER">
                        <columns resizable="true">
                            <column property="licenseType" header="msg://eu.occtet.bocfrontend.entity/LicenseType.licenseId"/>
                            <column property="priority" header="msg://eu.occtet.bocfrontend.entity/License.priority"/>
                            <column property="licenseText" header="msg://eu.occtet.bocfrontend.entity/License.licenseText"/>
                            <column property="licenseName" header="msg://eu.occtet.bocfrontend.entity/License.licenseName"/>
                            <column property="detailsUrl" header="msg://eu.occtet.bocfrontend.entity/SoftwareComponent.detailsUrl"/>
                            <column property="isModified" header="msg://eu.occtet.bocfrontend.entity/License.isModified"/>
                            <column property="curated" header="msg://eu.occtet.bocfrontend.entity/Copyright.curated"/>
                            <column property="isSpdx" header="msg://eu.occtet.bocfrontend.entity/License.isSpdx"/>
                        </columns>
                    </dataGrid>
                    <button id="addLicenseButton" text="msg://eu.occtet.bocfrontend.view.copyright/addLicense" alignSelf="CENTER"/>
                </vbox>
            </tab>
        </tabSheet>
    </layout>
</view>
