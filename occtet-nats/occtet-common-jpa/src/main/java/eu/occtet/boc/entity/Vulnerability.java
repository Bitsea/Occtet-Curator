/*
 *
 *  Copyright (C) 2025 Bitsea GmbH
 *  *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 *  SPDX-License-Identifier: Apache-2.0
 *  License-Filename: LICENSE
 * /
 *
 */

package eu.occtet.boc.entity;

import eu.occtet.boc.converter.StringListConverter;
import jakarta.annotation.Nonnull;
import jakarta.persistence.*;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

import java.time.LocalDateTime;
import java.util.List;


@Entity
@Table(name = "VULNERABILITY")
@EntityListeners(AuditingEntityListener.class)
public class Vulnerability {

    @Id
    @Column(name = "ID", nullable = false)
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;

    @Column(name = "VULNERABILITY_ID", nullable = false)
    private String vulnerabilityId;

    @Column(name = "SUMMARY",length = Integer.MAX_VALUE)
    private String summary;

    @Column(name = "ALIASES",length = Integer.MAX_VALUE)
    private String aliases;

    @Column(name = "WEIGHTED_SEVERITY")
    private Double weightedSeverity;

    @Column(name = "exploitability")
    private Double exploitability;

    @Column(name = "RISK_SCORE")
    private Double riskScore;

    @Column(name = "FIXED_PACKAGES")
    @Lob
    private String fixedPackages;

    @Column(name = "SOURCE_URL")
    private String sourceUrl;

    @Column(name = "REFRENCE_URLS")
    @Lob
    private List<String> references;

    @Column(name = "CREATED_AT", updatable = false)
    private @Nonnull LocalDateTime createdAt;

    public Vulnerability() {
        this.createdAt = LocalDateTime.now();
    }

    public Vulnerability(String vulnerabilityId, String summary, List<String> aliases,
                         Double weightedSeverity, Double exploitability, Double riskScore,
                         List<String> fixedPackages, String sourceUrl, List<String> references) {
        this.createdAt = LocalDateTime.now();
        this.vulnerabilityId = vulnerabilityId;
        this.summary = summary;
        this.aliases = StringListConverter.toStringOrNull(aliases);
        this.weightedSeverity = weightedSeverity;
        this.exploitability = exploitability;
        this.riskScore = riskScore;
        this.fixedPackages = StringListConverter.toStringOrNull( fixedPackages );
        this.sourceUrl = sourceUrl;
        this.references = references;
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getVulnerabilityId() {
        return vulnerabilityId;
    }

    public void setVulnerabilityId(String vulnerabilityId) {
        this.vulnerabilityId = vulnerabilityId;
    }

    public String getSummary() {
        return summary;
    }

    public void setSummary(String summary) {
        this.summary = summary;
    }

    public List<String> getAliases() {
        return StringListConverter.nullableStringToList(aliases);
    }

    public void setAliases(List<String> aliases) {
        this.aliases = StringListConverter.toStringOrNull(aliases);
    }

    public Double getWeightedSeverity() {
        return weightedSeverity;
    }

    public void setWeightedSeverity(Double weightedSeverity) {
        this.weightedSeverity = weightedSeverity;
    }

    public Double getRiskScore() {
        return riskScore;
    }

    public void setRiskScore(Double riskScore) {
        this.riskScore = riskScore;
    }

    public List<String> getFixedPackages() {
        return StringListConverter.nullableStringToList(fixedPackages);
    }

    public void setFixedPackages(List<String> fixedPackages) {
        this.fixedPackages = StringListConverter.toStringOrNull(fixedPackages);
    }

    @Nonnull
    public LocalDateTime getCreatedAt() {
        return createdAt;
    }

    public void setCreatedAt(@Nonnull LocalDateTime createdAt) {
        this.createdAt = createdAt;
    }

    public Double getExploitability() {
        return exploitability;
    }

    public void setExploitability(Double exploitability) {
        this.exploitability = exploitability;
    }

    public String getSourceUrl() {
        return sourceUrl;
    }

    public void setSourceUrl(String sourceUrl) {
        this.sourceUrl = sourceUrl;
    }

    public List<String> getReferences() {
        return references;
    }

    public void setReferences(List<String> references) {
        this.references = references;
    }

    public String toString() {
        return "Long :" +  id + ", vulnerability ID: " + vulnerabilityId;
    }
}
