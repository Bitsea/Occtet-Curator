package eu.occtet.boc.entity;

import eu.occtet.boc.converter.ListStringConverter;
import jakarta.annotation.Nonnull;
import jakarta.persistence.*;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

import java.time.LocalDateTime;
import java.util.List;
import java.util.UUID;

@Entity
@Table(name = "VULNERABILITY")
@EntityListeners(AuditingEntityListener.class)
public class Vulnerability {

    @Id
    @Column(name = "ID", nullable = false)
    @GeneratedValue(strategy = GenerationType.AUTO)
    private UUID id;

    @Column(name = "VULNERABILITY_ID", nullable = false)
    private String vulnerabilityId;

    @Column(name = "SUMMARY", columnDefinition = "TEXT")
    private String summary;

    @Column(name = "ALIASES", columnDefinition = "TEXT")
    @Convert(converter = ListStringConverter.class)
    private List<String> aliases;

    @Column(name = "WEIGHTED_SEVERITY")
    private Double weightedSeverity;

    @Column(name = "exploitability")
    private Double exploitability;

    @Column(name = "RISK_SCORE")
    private Double riskScore;

    @Column(name = "FIXED_PACKAGES", columnDefinition = "TEXT")
    @Convert(converter = ListStringConverter.class)
    private List<String> fixedPackages;

    @Column(name = "SOURCE_URL")
    private String sourceUrl;

    @Column(name = "REFRENCE_URLS", columnDefinition = "TEXT")
    @Convert(converter = ListStringConverter.class)
    private List<String> references;

    @Column(name = "CREATED_AT", updatable = false)
    private @Nonnull LocalDateTime createdAt;

    public Vulnerability() {
        this.createdAt = LocalDateTime.now();
    }

    public Vulnerability(String vulnerabilityId, String summary, List<String> aliases,
                         Double weightedSeverity, Double exploitability, Double riskScore,
                         List<String> fixedPackages, String sourceUrl, List<String> references) {
        this.createdAt = LocalDateTime.now();
        this.vulnerabilityId = vulnerabilityId;
        this.summary = summary;
        this.aliases = aliases;
        this.weightedSeverity = weightedSeverity;
        this.exploitability = exploitability;
        this.riskScore = riskScore;
        this.fixedPackages = fixedPackages;
        this.sourceUrl = sourceUrl;
        this.references = references;
    }

    public UUID getId() {
        return id;
    }

    public void setId(UUID id) {
        this.id = id;
    }

    public String getVulnerabilityId() {
        return vulnerabilityId;
    }

    public void setVulnerabilityId(String vulnerabilityId) {
        this.vulnerabilityId = vulnerabilityId;
    }

    public String getSummary() {
        return summary;
    }

    public void setSummary(String summary) {
        this.summary = summary;
    }

    public List<String> getAliases() {
        return aliases;
    }

    public void setAliases(List<String> aliases) {
        this.aliases = aliases;
    }

    public Double getWeightedSeverity() {
        return weightedSeverity;
    }

    public void setWeightedSeverity(Double weightedSeverity) {
        this.weightedSeverity = weightedSeverity;
    }

    public Double getRiskScore() {
        return riskScore;
    }

    public void setRiskScore(Double riskScore) {
        this.riskScore = riskScore;
    }

    public List<String> getFixedPackages() {
        return fixedPackages;
    }

    public void setFixedPackages(List<String> fixedPackages) {
        this.fixedPackages = fixedPackages;
    }

    @Nonnull
    public LocalDateTime getCreatedAt() {
        return createdAt;
    }

    public void setCreatedAt(@Nonnull LocalDateTime createdAt) {
        this.createdAt = createdAt;
    }

    public Double getExploitability() {
        return exploitability;
    }

    public void setExploitability(Double exploitability) {
        this.exploitability = exploitability;
    }

    public String getSourceUrl() {
        return sourceUrl;
    }

    public void setSourceUrl(String sourceUrl) {
        this.sourceUrl = sourceUrl;
    }

    public List<String> getReferences() {
        return references;
    }

    public void setReferences(List<String> references) {
        this.references = references;
    }
}
